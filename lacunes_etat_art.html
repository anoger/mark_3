<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic des Lacunes - Ã‰tat de l'Art</title>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --ink: #1a1a1a;
            --paper: #f8f5f0;
            --cream: #faf8f5;
            --accent: #8b4513;
            --accent-light: #a0522d;
            --success: #2e7d32;
            --success-light: #4caf50;
            --warning: #f57c00;
            --danger: #c62828;
            --pending: #78909c;
            --border: #e0dcd5;
            --info-repeat: #1565c0;
            --ref-redundant: #7b1fa2;
            --progression: #00796b;
            --cite-consec: #e65100;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Outfit', sans-serif;
            background: var(--paper);
            color: var(--ink);
            line-height: 1.6;
        }

        .container { max-width: 1800px; margin: 0 auto; padding: 1.5rem; }

        header {
            text-align: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--border);
        }

        h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2rem;
            font-weight: 600;
            color: var(--ink);
            margin-bottom: 0.25rem;
        }

        .subtitle { font-size: 0.9rem; color: var(--accent); }
        .date-update { font-size: 0.75rem; color: var(--pending); margin-top: 0.25rem; }

        /* Stats Row */
        .stats-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
        }

        .stat-card {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1.25rem;
            text-align: center;
            flex: 1;
            min-width: 140px;
        }

        .stat-card.info-repeat { border-left: 4px solid var(--info-repeat); }
        .stat-card.ref-redundant { border-left: 4px solid var(--ref-redundant); }
        .stat-card.progression { border-left: 4px solid var(--progression); }
        .stat-card.cite-consec { border-left: 4px solid var(--cite-consec); }

        .stat-value {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.75rem;
            font-weight: 700;
        }

        .stat-card.info-repeat .stat-value { color: var(--info-repeat); }
        .stat-card.ref-redundant .stat-value { color: var(--ref-redundant); }
        .stat-card.progression .stat-value { color: var(--progression); }
        .stat-card.cite-consec .stat-value { color: var(--cite-consec); }

        .stat-label { font-size: 0.8rem; color: var(--pending); }

        /* Filters Panel */
        .filters-panel {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            margin-bottom: 1.5rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
            align-items: center;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        .filter-label {
            font-size: 0.75rem;
            font-weight: 500;
            color: var(--pending);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-options {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            background: white;
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 0.35rem 0.85rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .filter-btn:hover { border-color: var(--accent); }
        .filter-btn.active { background: var(--accent); color: white; border-color: var(--accent); }

        .filter-btn.type-info { border-color: var(--info-repeat); }
        .filter-btn.type-info.active { background: var(--info-repeat); border-color: var(--info-repeat); }
        .filter-btn.type-ref { border-color: var(--ref-redundant); }
        .filter-btn.type-ref.active { background: var(--ref-redundant); border-color: var(--ref-redundant); }
        .filter-btn.type-prog { border-color: var(--progression); }
        .filter-btn.type-prog.active { background: var(--progression); border-color: var(--progression); }
        .filter-btn.type-cite { border-color: var(--cite-consec); }
        .filter-btn.type-cite.active { background: var(--cite-consec); border-color: var(--cite-consec); }

        .search-input {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: 20px;
            font-size: 0.85rem;
            min-width: 200px;
            font-family: inherit;
        }

        .search-input:focus { outline: none; border-color: var(--accent); }

        /* Table */
        .table-container {
            background: white;
            border: 1px solid var(--border);
            border-radius: 12px;
            overflow: hidden;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: var(--cream);
            position: sticky;
            top: 0;
            z-index: 10;
        }

        th {
            padding: 0.85rem 1rem;
            text-align: left;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--ink);
            border-bottom: 2px solid var(--border);
            cursor: pointer;
            user-select: none;
            white-space: nowrap;
        }

        th:hover { background: #ebe7e0; }

        th .sort-icon {
            margin-left: 0.4rem;
            opacity: 0.3;
        }

        th.sorted .sort-icon { opacity: 1; }

        td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border);
            font-size: 0.85rem;
            vertical-align: top;
        }

        tr:hover { background: #faf8f5; }

        /* Badges */
        .badge {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .badge.info-repeat { background: #e3f2fd; color: var(--info-repeat); }
        .badge.ref-redundant { background: #f3e5f5; color: var(--ref-redundant); }
        .badge.progression { background: #e0f2f1; color: var(--progression); }
        .badge.cite-consec { background: #fff3e0; color: var(--cite-consec); }

        .severity {
            font-size: 1.1rem;
        }

        .file-link {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.75rem;
            color: var(--accent);
            text-decoration: none;
        }

        .file-link:hover { text-decoration: underline; }

        .excerpt {
            max-width: 350px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
            color: var(--ink);
            font-size: 0.8rem;
        }

        .excerpt.expanded {
            white-space: normal;
            max-width: none;
            background: #fffef5;
            padding: 0.5rem;
            border-radius: 4px;
            border: 1px solid #f0ead6;
        }

        .chapter-badge {
            background: var(--cream);
            border: 1px solid var(--border);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .recommendation {
            font-size: 0.8rem;
            color: var(--pending);
            font-style: italic;
        }

        /* Export Panel */
        .export-panel {
            margin-top: 1.5rem;
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        .export-btn {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 6px;
            padding: 0.5rem 1rem;
            font-size: 0.8rem;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.2s;
        }

        .export-btn:hover {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 3rem;
            color: var(--pending);
        }

        .no-results-icon { font-size: 3rem; margin-bottom: 1rem; }

        /* Responsive */
        @media (max-width: 1200px) {
            .excerpt { max-width: 250px; }
        }

        @media (max-width: 768px) {
            .filters-panel { flex-direction: column; align-items: stretch; }
            .filter-group { width: 100%; }
            .stats-row { flex-direction: column; }
            .table-container { overflow-x: auto; }
        }

        /* Count badge */
        .count-badge {
            background: var(--border);
            color: var(--ink);
            padding: 0.1rem 0.4rem;
            border-radius: 10px;
            font-size: 0.7rem;
            margin-left: 0.3rem;
        }

        /* Legend */
        .legend {
            background: var(--cream);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 1rem;
            font-size: 0.8rem;
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Diagnostic des Lacunes de l'Ã‰tat de l'Art</h1>
            <p class="subtitle">Analyse automatique des fichiers LaTeX du Chapitre 2</p>
            <p class="date-update">Analyse du 26 janvier 2026</p>
        </header>

        <!-- Stats -->
        <div class="stats-row">
            <div class="stat-card info-repeat">
                <div class="stat-value" id="count-info">0</div>
                <div class="stat-label">Infos Repetees</div>
            </div>
            <div class="stat-card ref-redundant">
                <div class="stat-value" id="count-ref">0</div>
                <div class="stat-label">Refs Redondantes</div>
            </div>
            <div class="stat-card progression">
                <div class="stat-value" id="count-prog">0</div>
                <div class="stat-label">Progression</div>
            </div>
            <div class="stat-card cite-consec">
                <div class="stat-value" id="count-cite">0</div>
                <div class="stat-label">Citations Consec.</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="count-total">0</div>
                <div class="stat-label">Total</div>
            </div>
        </div>

        <!-- Legend -->
        <div class="legend">
            <div class="legend-item"><span class="severity">&#128308;</span> Critique</div>
            <div class="legend-item"><span class="severity">&#128992;</span> Important</div>
            <div class="legend-item"><span class="severity">&#128993;</span> Mineur</div>
            <div class="legend-item">| Cliquez sur un extrait pour l'agrandir</div>
        </div>

        <!-- Filters -->
        <div class="filters-panel">
            <div class="filter-group">
                <span class="filter-label">Type</span>
                <div class="filter-options" id="type-filters">
                    <button class="filter-btn type-info active" data-type="info-repeat">Info Repetee</button>
                    <button class="filter-btn type-ref active" data-type="ref-redundant">Ref Redondante</button>
                    <button class="filter-btn type-prog active" data-type="progression">Progression</button>
                    <button class="filter-btn type-cite active" data-type="cite-consec">Citation Consec.</button>
                </div>
            </div>
            <div class="filter-group">
                <span class="filter-label">Severite</span>
                <div class="filter-options" id="severity-filters">
                    <button class="filter-btn active" data-severity="critical">&#128308; Critique</button>
                    <button class="filter-btn active" data-severity="important">&#128992; Important</button>
                    <button class="filter-btn active" data-severity="minor">&#128993; Mineur</button>
                </div>
            </div>
            <div class="filter-group">
                <span class="filter-label">Chapitre</span>
                <div class="filter-options" id="chapter-filters">
                    <button class="filter-btn active" data-chapter="all">Tous</button>
                    <button class="filter-btn" data-chapter="1">Ch.1</button>
                    <button class="filter-btn" data-chapter="2">Ch.2</button>
                </div>
            </div>
            <div class="filter-group">
                <span class="filter-label">Recherche</span>
                <input type="text" class="search-input" id="search-input" placeholder="Filtrer par texte...">
            </div>
        </div>

        <!-- Table -->
        <div class="table-container">
            <table id="lacunae-table">
                <thead>
                    <tr>
                        <th data-sort="id"># <span class="sort-icon">&#8597;</span></th>
                        <th data-sort="type">Type <span class="sort-icon">&#8597;</span></th>
                        <th data-sort="severity">Sev. <span class="sort-icon">&#8597;</span></th>
                        <th data-sort="file">Fichier <span class="sort-icon">&#8597;</span></th>
                        <th data-sort="line">Ligne <span class="sort-icon">&#8597;</span></th>
                        <th data-sort="excerpt">Extrait</th>
                        <th data-sort="chapter">Ch.</th>
                        <th data-sort="section">Section</th>
                        <th>Recommandation</th>
                    </tr>
                </thead>
                <tbody id="table-body">
                </tbody>
            </table>
            <div class="no-results" id="no-results" style="display: none;">
                <div class="no-results-icon">&#128269;</div>
                <p>Aucune lacune ne correspond aux filtres selectionnes.</p>
            </div>
        </div>

        <!-- Export -->
        <div class="export-panel">
            <button class="export-btn" onclick="exportCSV()">Exporter CSV</button>
            <button class="export-btn" onclick="exportJSON()">Exporter JSON</button>
            <button class="export-btn" onclick="exportMarkdown()">Exporter Markdown</button>
        </div>
    </div>

    <script>
    // ============================================
    // DONNEES DES LACUNES DETECTEES
    // ============================================
    const lacunaeData = [
        // === REPETITION D'INFORMATIONS ===
        {
            id: 1,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Ch1_Introduction.tex",
            line: 15,
            excerpt: "Les agents combinant apparence humanoide et interactions structurees produisent les effets les plus marques",
            chapter: 1,
            section: "1.1",
            recommendation: "Concept repris en 2.3.1 et 2.3.4 - Centraliser en Ch.2",
            relatedFiles: ["2_3_1_cartographie_agents.tex", "2_3_4_taxonomie_signaux.tex"]
        },
        {
            id: 2,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "critical",
            severityIcon: "&#128308;",
            file: "Ch1_Introduction.tex",
            line: 29,
            excerpt: "illusion de comprehension... tendance a surestimer la profondeur de ses propres connaissances",
            chapter: 1,
            section: "1.2",
            recommendation: "Definition reprise quasi-identique en 2.5.1 - Supprimer l'une",
            relatedFiles: ["2_5_1_metacognition_IOED.tex"]
        },
        {
            id: 3,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Ch1_Introduction.tex",
            line: 31,
            excerpt: "heuristique de fluidite : une information facile a traiter est percue comme familiere",
            chapter: 1,
            section: "1.2",
            recommendation: "Concept defini aussi en 2.5.2 - Garder ref. breve en Ch.1",
            relatedFiles: ["2_5_2_fluency_heuristic.tex"]
        },
        {
            id: 4,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_1_1_SDT_CET.tex",
            line: 18,
            excerpt: "autonomie, competence et appartenance sociale",
            chapter: 2,
            section: "2.1.1",
            recommendation: "Besoins SDT mentionnes aussi en 2.2.2 ligne 26 - Renvoyer a 2.1.1",
            relatedFiles: ["2_2_2_perception_eleves.tex"]
        },
        {
            id: 5,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "minor",
            severityIcon: "&#128993;",
            file: "2_3_1_cartographie_agents.tex",
            line: 14,
            excerpt: "effet de persona : sa seule presence ameliorait la motivation des apprenants",
            chapter: 2,
            section: "2.3.1",
            recommendation: "Concept mentionne aussi en 2.3.2 - Consolider",
            relatedFiles: ["2_3_2_fondements_cognitifs.tex"]
        },
        {
            id: 6,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "critical",
            severityIcon: "&#128308;",
            file: "2_6_1_convergences_tensions.tex",
            line: 13,
            excerpt: "Le cadre ICAP predit que l'interactivite dialogique active les modes d'engagement les plus profonds",
            chapter: 2,
            section: "2.6.1",
            recommendation: "Repetition directe de 2.1.4 - Synthetiser par reference",
            relatedFiles: ["2_1_4_ICAP.tex"]
        },
        {
            id: 7,
            type: "info-repeat",
            typeLabel: "Info Repetee",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_4_3_hallucinations.tex",
            line: 16,
            excerpt: "la fluidite du discours constitue un signal de credibilite... un recit bien construit est intuitivement percu comme plus vrai",
            chapter: 2,
            section: "2.4.3",
            recommendation: "Redit en 2.5.2 et 2.5.3 - Unifier en une section",
            relatedFiles: ["2_5_2_fluency_heuristic.tex", "2_5_3_autorite_vigilance.tex"]
        },

        // === REFERENCES REDONDANTES ===
        {
            id: 8,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "critical",
            severityIcon: "&#128308;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{hidi2006four} - 6+ occurrences dans fichiers differents",
            chapter: 2,
            section: "2.1, 2.2",
            recommendation: "Reference centrale - Definir en 2.1.2, renvoyer ailleurs",
            relatedFiles: ["2_1_2_architecture_interet.tex", "2_1_3_pertinence_personnalisation.tex", "2_2_2_perception_eleves.tex"]
        },
        {
            id: 9,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "critical",
            severityIcon: "&#128308;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{nass1994computers} - Paradigme CASA cite dans 5+ fichiers",
            chapter: 2,
            section: "2.1, 2.3, 2.5",
            recommendation: "Definir CASA en 2.3.3, reference courte ailleurs",
            relatedFiles: ["Ch1_Introduction.tex", "2_3_3_presence_sociale.tex", "2_5_3_autorite_vigilance.tex"]
        },
        {
            id: 10,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{haydn2010pupil} - 4+ occurrences",
            chapter: 2,
            section: "2.2",
            recommendation: "Source principale 2.2.1-2.2.2 - Reduire ailleurs",
            relatedFiles: ["Ch1_Introduction.tex", "2_2_1_epistemologie_STIM.tex", "2_2_2_perception_eleves.tex"]
        },
        {
            id: 11,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{vanstraaten2015making} - 4+ occurrences",
            chapter: 2,
            section: "2.2",
            recommendation: "Centraliser en 2.2.3",
            relatedFiles: ["Ch1_Introduction.tex", "2_2_1_epistemologie_STIM.tex", "2_2_3_pratiques_pedagogiques.tex"]
        },
        {
            id: 12,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{dai2024effects} / \\citep{dai2022systematic} - Mix des deux references",
            chapter: 2,
            section: "2.3, 2.6",
            recommendation: "Clarifier quelle meta-analyse est citee ou",
            relatedFiles: ["Ch1_Introduction.tex", "2_3_4_taxonomie_signaux.tex", "2_6_2_lacunes_litterature.tex"]
        },
        {
            id: 13,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "minor",
            severityIcon: "&#128993;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{reber1999effects} - 4 occurrences",
            chapter: 2,
            section: "2.4, 2.5",
            recommendation: "Reference fondamentale fluidite - OK si contextes differents",
            relatedFiles: ["Ch1_Introduction.tex", "2_4_3_hallucinations.tex", "2_5_2_fluency_heuristic.tex"]
        },
        {
            id: 14,
            type: "ref-redundant",
            typeLabel: "Ref Redondante",
            severity: "important",
            severityIcon: "&#128992;",
            file: "Multiple",
            line: "-",
            excerpt: "\\citep{castroalonso2021effectiveness} - 4+ occurrences",
            chapter: 2,
            section: "2.3",
            recommendation: "Meta-analyse centrale 2.3 - Definir une fois, ref. courtes",
            relatedFiles: ["2_3_1_cartographie_agents.tex", "2_3_4_taxonomie_signaux.tex", "2_3_5_limites_realisme.tex"]
        },

        // === PROGRESSION LOGIQUE ===
        {
            id: 15,
            type: "progression",
            typeLabel: "Progression",
            severity: "critical",
            severityIcon: "&#128308;",
            file: "Ch1_Introduction.tex",
            line: 27,
            excerpt: "paradigme CASA (Computers Are Social Actors) mentionne avant sa definition en 2.3.3",
            chapter: 1,
            section: "1.2",
            recommendation: "Ajouter '(cf. S2.3.3)' ou deplacer explication",
            relatedFiles: ["2_3_3_presence_sociale.tex"]
        },
        {
            id: 16,
            type: "progression",
            typeLabel: "Progression",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_1_3_pertinence_personnalisation.tex",
            line: 12,
            excerpt: "Reference a 'interet situationnel' avant definition complete en 2.1.2",
            chapter: 2,
            section: "2.1.3",
            recommendation: "Verifier ordre des sous-sections 2.1.2 vs 2.1.3",
            relatedFiles: ["2_1_2_architecture_interet.tex"]
        },
        {
            id: 17,
            type: "progression",
            typeLabel: "Progression",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_4_3_hallucinations.tex",
            line: 16,
            excerpt: "Reference a heuristique de fluidite (cf. S2.5.2) - section qui vient apres",
            chapter: 2,
            section: "2.4.3",
            recommendation: "Soit inverser 2.4/2.5, soit ref. forward explicite",
            relatedFiles: ["2_5_2_fluency_heuristic.tex"]
        },
        {
            id: 18,
            type: "progression",
            typeLabel: "Progression",
            severity: "minor",
            severityIcon: "&#128993;",
            file: "2_6_1_convergences_tensions.tex",
            line: 13,
            excerpt: "Resume ICAP, SDT, CASA sans apport nouveau - section de synthese OK",
            chapter: 2,
            section: "2.6.1",
            recommendation: "Acceptable si explicitement synthetique",
            relatedFiles: []
        },
        {
            id: 19,
            type: "progression",
            typeLabel: "Progression",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_3_2_fondements_cognitifs.tex",
            line: 0,
            excerpt: "CTML introduit en 2.3.2 mais utilise implicitement des 2.1.4 (ICAP)",
            chapter: 2,
            section: "2.3.2",
            recommendation: "Ajouter transition explicite ICAP -> CTML",
            relatedFiles: ["2_1_4_ICAP.tex"]
        },

        // === CITATIONS CONSECUTIVES ===
        {
            id: 20,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_2_2_perception_eleves.tex",
            line: "13-17",
            excerpt: "\\citep{haydn2010pupil} cite 3 fois en 5 lignes",
            chapter: 2,
            section: "2.2.2",
            recommendation: "Fusionner en une citation avec pages specifiques",
            relatedFiles: []
        },
        {
            id: 21,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_3_4_taxonomie_signaux.tex",
            line: "47-54",
            excerpt: "\\citep{davis2018impact} cite 3 fois consecutives",
            chapter: 2,
            section: "2.3.4",
            recommendation: "Regrouper en un paragraphe avec citation unique",
            relatedFiles: []
        },
        {
            id: 22,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "minor",
            severityIcon: "&#128993;",
            file: "2_1_2_architecture_interet.tex",
            line: "15-19",
            excerpt: "\\citep{hidi2006four} cite 2 fois proches",
            chapter: 2,
            section: "2.1.2",
            recommendation: "Acceptable si contextes differents",
            relatedFiles: []
        },
        {
            id: 23,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_2_3_pratiques_pedagogiques.tex",
            line: "16-20",
            excerpt: "\\citep{harris2006pupils} cite 2 fois en 4 lignes",
            chapter: 2,
            section: "2.2.3",
            recommendation: "Consolider citations",
            relatedFiles: []
        },
        {
            id: 24,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "minor",
            severityIcon: "&#128993;",
            file: "2_5_3_autorite_vigilance.tex",
            line: "14-16",
            excerpt: "Multiple citations Zhang 2025 proches",
            chapter: 2,
            section: "2.5.3",
            recommendation: "Verifier si meme source ou differentes",
            relatedFiles: []
        },
        {
            id: 25,
            type: "cite-consec",
            typeLabel: "Citation Consec.",
            severity: "important",
            severityIcon: "&#128992;",
            file: "2_3_1_cartographie_agents.tex",
            line: "12-18",
            excerpt: "Section dense avec 5+ citations sur 6 lignes",
            chapter: 2,
            section: "2.3.1",
            recommendation: "Aerer - separer en sous-paragraphes",
            relatedFiles: []
        }
    ];

    // ============================================
    // LOGIQUE D'AFFICHAGE ET FILTRAGE
    // ============================================

    let currentFilters = {
        types: ['info-repeat', 'ref-redundant', 'progression', 'cite-consec'],
        severities: ['critical', 'important', 'minor'],
        chapter: 'all',
        search: ''
    };

    let sortConfig = { column: 'id', direction: 'asc' };

    function renderTable() {
        const tbody = document.getElementById('table-body');
        const noResults = document.getElementById('no-results');

        let filtered = lacunaeData.filter(item => {
            if (!currentFilters.types.includes(item.type)) return false;
            if (!currentFilters.severities.includes(item.severity)) return false;
            if (currentFilters.chapter !== 'all' && item.chapter !== parseInt(currentFilters.chapter)) return false;
            if (currentFilters.search) {
                const searchLower = currentFilters.search.toLowerCase();
                if (!item.excerpt.toLowerCase().includes(searchLower) &&
                    !item.file.toLowerCase().includes(searchLower) &&
                    !item.recommendation.toLowerCase().includes(searchLower)) {
                    return false;
                }
            }
            return true;
        });

        // Sort
        filtered.sort((a, b) => {
            let valA = a[sortConfig.column];
            let valB = b[sortConfig.column];

            if (sortConfig.column === 'severity') {
                const order = { critical: 0, important: 1, minor: 2 };
                valA = order[valA];
                valB = order[valB];
            }

            if (typeof valA === 'string') {
                valA = valA.toLowerCase();
                valB = valB.toLowerCase();
            }

            if (valA < valB) return sortConfig.direction === 'asc' ? -1 : 1;
            if (valA > valB) return sortConfig.direction === 'asc' ? 1 : -1;
            return 0;
        });

        // Update counts
        updateCounts(filtered);

        if (filtered.length === 0) {
            tbody.innerHTML = '';
            noResults.style.display = 'block';
            return;
        }

        noResults.style.display = 'none';

        tbody.innerHTML = filtered.map(item => `
            <tr>
                <td>${item.id}</td>
                <td><span class="badge ${item.type}">${item.typeLabel}</span></td>
                <td class="severity">${item.severityIcon}</td>
                <td><span class="file-link">${item.file}</span></td>
                <td>${item.line}</td>
                <td><span class="excerpt" onclick="toggleExcerpt(this)">${item.excerpt}</span></td>
                <td><span class="chapter-badge">Ch.${item.chapter}</span></td>
                <td>${item.section}</td>
                <td><span class="recommendation">${item.recommendation}</span></td>
            </tr>
        `).join('');
    }

    function updateCounts(filtered) {
        const counts = {
            'info-repeat': 0,
            'ref-redundant': 0,
            'progression': 0,
            'cite-consec': 0
        };

        filtered.forEach(item => {
            counts[item.type]++;
        });

        document.getElementById('count-info').textContent = counts['info-repeat'];
        document.getElementById('count-ref').textContent = counts['ref-redundant'];
        document.getElementById('count-prog').textContent = counts['progression'];
        document.getElementById('count-cite').textContent = counts['cite-consec'];
        document.getElementById('count-total').textContent = filtered.length;
    }

    function toggleExcerpt(el) {
        el.classList.toggle('expanded');
    }

    // Filter handlers
    document.querySelectorAll('#type-filters .filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            btn.classList.toggle('active');
            const type = btn.dataset.type;
            if (btn.classList.contains('active')) {
                currentFilters.types.push(type);
            } else {
                currentFilters.types = currentFilters.types.filter(t => t !== type);
            }
            renderTable();
        });
    });

    document.querySelectorAll('#severity-filters .filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            btn.classList.toggle('active');
            const sev = btn.dataset.severity;
            if (btn.classList.contains('active')) {
                currentFilters.severities.push(sev);
            } else {
                currentFilters.severities = currentFilters.severities.filter(s => s !== sev);
            }
            renderTable();
        });
    });

    document.querySelectorAll('#chapter-filters .filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('#chapter-filters .filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            currentFilters.chapter = btn.dataset.chapter;
            renderTable();
        });
    });

    document.getElementById('search-input').addEventListener('input', (e) => {
        currentFilters.search = e.target.value;
        renderTable();
    });

    // Sort handlers
    document.querySelectorAll('th[data-sort]').forEach(th => {
        th.addEventListener('click', () => {
            const col = th.dataset.sort;
            if (sortConfig.column === col) {
                sortConfig.direction = sortConfig.direction === 'asc' ? 'desc' : 'asc';
            } else {
                sortConfig.column = col;
                sortConfig.direction = 'asc';
            }

            document.querySelectorAll('th').forEach(t => t.classList.remove('sorted'));
            th.classList.add('sorted');
            th.querySelector('.sort-icon').innerHTML = sortConfig.direction === 'asc' ? '&#8593;' : '&#8595;';

            renderTable();
        });
    });

    // Export functions
    function exportCSV() {
        const headers = ['ID', 'Type', 'Severite', 'Fichier', 'Ligne', 'Extrait', 'Chapitre', 'Section', 'Recommandation'];
        const rows = lacunaeData.map(item => [
            item.id,
            item.typeLabel,
            item.severity,
            item.file,
            item.line,
            `"${item.excerpt.replace(/"/g, '""')}"`,
            item.chapter,
            item.section,
            `"${item.recommendation.replace(/"/g, '""')}"`
        ]);

        const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
        downloadFile(csv, 'lacunes_etat_art.csv', 'text/csv');
    }

    function exportJSON() {
        const json = JSON.stringify(lacunaeData, null, 2);
        downloadFile(json, 'lacunes_etat_art.json', 'application/json');
    }

    function exportMarkdown() {
        let md = '# Diagnostic des Lacunes de l\'Etat de l\'Art\n\n';
        md += `> Analyse du ${new Date().toLocaleDateString('fr-FR')}\n\n`;

        const types = {
            'info-repeat': 'Repetition d\'informations',
            'ref-redundant': 'References redondantes',
            'progression': 'Progression logique',
            'cite-consec': 'Citations consecutives'
        };

        Object.keys(types).forEach(type => {
            const items = lacunaeData.filter(i => i.type === type);
            if (items.length > 0) {
                md += `## ${types[type]} (${items.length})\n\n`;
                items.forEach(item => {
                    const sevEmoji = item.severity === 'critical' ? 'ðŸ”´' : item.severity === 'important' ? 'ðŸŸ ' : 'ðŸŸ¡';
                    md += `### ${sevEmoji} ${item.file}:${item.line}\n`;
                    md += `> ${item.excerpt}\n\n`;
                    md += `**Recommandation:** ${item.recommendation}\n\n`;
                });
            }
        });

        downloadFile(md, 'lacunes_etat_art.md', 'text/markdown');
    }

    function downloadFile(content, filename, type) {
        const blob = new Blob([content], { type: type + ';charset=utf-8' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.click();
        URL.revokeObjectURL(url);
    }

    // Initial render
    renderTable();
    </script>
</body>
</html>
